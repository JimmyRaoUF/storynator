<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<style type="text/css" media="screen">
		@import url(https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700);

		.story {
			box-sizing: border-box;
			font: 400 13px/1.25 "Anonymous Pro";
			padding-top: 3em;
		}
		.story .parts,
		.story .parts ul,
		.story p {
			margin: 0;
			padding: 0;
			list-style: none;
		}
		ul.parts {
			margin-top: 8em !important;
			font-size: 11px;
			counter-reset: part;
			counter-reset: partcase;
			counter-reset: totalcase;
		}
		.part {
			position: relative;
			clear: both;
		}
		.part,
		.part-placeholder {
			position: relative;
			border-left: 1em solid #BDBDBD;
			margin: 1em 2em;
			padding: 0 2em 3em; 
			counter-increment: part;
		}
		.part-placeholder {
			background: #f5f5f5;
			border: 5px dashed #234;
		}
		.part-header {
			float: left;
			width: 15%;
			max-width: 15em;
			padding-right: 4em;
		}
		.nocases .part {
			padding-bottom: 0;
		}
		.nocases .part-header {
			float: none;
			width: auto;
			max-width: 40em;
		}
		.part-title {
			margin-top: 0;
			font-size: 11px;
			font-weight: 700;
			text-shadow: 0;
		}
		.cases {
			display: flex;
			flex-flow: row wrap; 
		}
		.case {
			display: flex;
			flex-flow: column;
			counter-increment: totalcase;
		}
		.nocases .part .cases {
			display: none;
		}
		.case,
		.case-placeholder,
		.cases .add {
			position: relative;
			margin: 1em;
			width: 25%;
			min-width: 300px;
		}
		.bigimg .case,
		.bigimg .case-placeholder,
		.bigimg .cases .add {
			width: 15%;
			min-width: 200px;
		}
		.cases .case-placeholder {
			background: #f5f5f5;
			border: 1px dashed grey;
		}
		.case.pano {
			width: auto !important;
			min-width: auto !important;
		}
		.case .img {
			counter-increment: partcase;
			position: relative;
		}
		.case img {
			width: 100%;
		}
		.case img.dragenter {
			outline: 5px solid #00796B;
		}
		.case p {
			position: relative;
			padding: .5em 0;
			margin-bottom: 0;
		}
		.notexts .part-overview,
		.notexts .case p,
		.notexts .case::after {
			display: none;
		}

		.handle {
			border: .5em dotted #EEEEEE;
			background: #f5f5f5;
			width: 1em;
			position: absolute;
			top: 0;
			bottom: 0;
			left: -1.9em;
		}
		.nomanage .handle {
			display: none;
		}

		/* numerotation */

		.part-header::before {
			content: counter(part, decimal-leading-zero);
			font-size: 1em;
			color: #aaa;
			position: absolute;
			top: 0;
			left: .5em;
			text-align: right;
		}
		.case::after {
			content: "P"counter(totalcase, decimal-leading-zero)" (S"counter(part, decimal-leading-zero)"-"counter(partcase, decimal-leading-zero)")";
			top: 0; bottom: 0;
			right: 0;
			color: #555;
		}

		/* buttons */

		.btn,
		.btn:visited {
			cursor: pointer;
			text-decoration: none;
			color: #00796B;
			font-weight: 700;
		}
		.btn:hover {
			color: #FF5722;
		}
		.btn.partdel {
			position: absolute;
			left: -1.8em;
			top: 0;
			z-index: 999;
		}
		.nomanage .btn.partdel,
		.nomanage .btn.add {
			display: none;
		}
		.overlay {
			position: absolute;
			right: 0; left: 0;
			top: 0; bottom: 0;
			background: rgba(255,255,255,.5);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			z-index: 999;
		}
		.nomanage .overlay {
			display: none;
		}
		.btn.delete::after,
		.overlay .delete::after {
			content: "✕";
			font-size: 2em;
			text-align: center;
		}
		.overlay .pano::after {
			content: "⇔";
			font-size: 2em;
			text-align: center;
		}
		.add {
			font-size: 1.2em;
		}
		.add-part {
			display: inline;
			text-transform: uppercase;
			padding: 2em;
		}
		.add-case {
			display: flex;
			align-items: center;
			justify-content: center;
			text-transform: uppercase;
			padding: 1em 0;
			border: 1px solid #eee;
			background: #f5f5f5;
			border-radius: 3px;
		}
		.add-part::after {
			content: "Add a new part";
		}
		.add-case::after {
			content: "Add a new case";
		}

		/* header / display switches */

		.header {
			position: fixed;
			background: #fff;
			top: 0;
			right: 0;
			left: 0;
			z-index: 999;
			box-shadow: 0 0 1px;
			padding: 1em;
		}
		.header div,
		.header h1,
		.header ul {
			display: inline-block;
		}
		.header h1 {
			margin: 0;
		}
		.header ul {
			float: right;
			margin-top: .5em;
		}
		.header li {
			display: inline-block;
		}
		.header .btn {
			padding: 0 1em;
		}
		.toggle::before {
			font-weight: 300;
			content: "☑";
			padding-right: .5em;
		}
		.notexts .btn-texts::before,
		.nomanage .btn-manage::before,
		.bigimg .btn-bigimg::before,
		.nocases .btn-cases::before {
			content: "☐";
		}

		@media only screen and (max-width : 600px) {
			.part {
				margin-left: 0;
				margin-right: 0;
			}
			.part-header {
				float: none;
				width: auto;
				max-width: 40em;
				padding-right: 0;
				padding-bottom: 4em;
			}
		}
	</style>
</head>
<body>
	<div class="story">
		<header class="header">
			<div contenteditable="true"><h1>Storyboard</h1></div>
			<ul>
				<li><div class="btn toggle btn-manage">Manage</div></li>
				<li><div class="btn toggle btn-cases">Cases</div></li>
				<li><div class="btn toggle btn-texts">Texts</div></li>
				<li><div class="btn toggle btn-bigimg">Big picture</div></li>
				<li><a class="btn" href="https://github.com/nliautaud/storynator" target="_blank">Github</a></li>
			</ul>
		</header>
		<ul class="parts sortable" data-sortable-id="0" aria-dropeffect="move">
			<div class="btn add add-part"></div>
		</ul>
	</div>
	<script src="./story_files/_jquery-2.1.4.min.js"></script>
	<script src="./story_files/_html.sortable.min.js"></script>
	<script id="part-tpl" type="text/x-custom-template">
		<li class="part">
			<div class="handle"></div>
			<div class="btn partdel"></div>
			<header class="part-header">
				<h1 class="part-title" contenteditable="true">Title</h1>
				<p class="part-overview" contenteditable="true">Overview</p>
			</header>
			<ul class="cases sortable connected">
				<div class="btn add add-case"></div>
			</ul>
		</li>
	</script>
	<script id="case-tpl" type="text/x-custom-template">
		<li class="case">
			<div class="img"><img src="./story_files/_placeholder.png"></div>
			<p contenteditable="true">caption</p>
		</li>
	</script>
	<script id="overlay-tpl" type="text/x-custom-template">
		<div class="overlay">
			<div class="btn delete"></div>
			<div class="btn pano"></div>
		</div>
	</script>
	<script type="text/javascript" charset="utf-8" async="" defer="">
		$(function() {
			var case_tpl = $('#case-tpl').html();
			var part_tpl = $('#part-tpl').html();
			var overlay_tpl = $('#overlay-tpl').html();
			var story = $('.story');
			var dragcase = false;

			var onstart = function(e, ui) {
				dragcase = true;
			};
			var onstop = function(e, ui) {
				dragcase = false;
			};
			$('.parts.sortable').sortable({
				forcePlaceholderSize: false,
				handle: '.handle',
				items: '.part',
				placeholderClass: 'part-placeholder'
			});
			$('.cases.sortable').sortable({
				forcePlaceholderSize: true,
				connectWith: '.parts',
				handle: '.img',
				items: '.case',
				placeholderClass: 'case-placeholder'
			}).bind('sortstart', onstart).bind('sortstop', onstop);

			//*/// add

			story.delegate('.add-case', 'click', function(e){
				$(case_tpl).insertBefore($(this));
				$('.cases.sortable')
					.sortable('reload')
					.bind('sortstart', onstart)
					.bind('sortstop', onstop);
			});
			story.delegate('.add-part', 'click', function(e){
				$(part_tpl).find('.cases').prepend(case_tpl);
				$(part_tpl).insertBefore($(this));
				$('.parts.sortable').sortable('reload');
			});

			//*/// case overlay & part delete

			story.delegate('.case .img', 'click', function(event){
				$('.overlay').remove();
				$(this).prepend(overlay_tpl);
    			event.stopPropagation();
			});
			$(window).on('click', function() {
				$('.overlay').remove();
			});
			story.delegate('.overlay .delete', 'click', function(e){
				$(this).closest('.case').animate({
					opacity: 0, width: 0, minWidth: 0
				}, function() {
					$(this).closest('.case').remove();
				});
			});
			story.delegate('.overlay .pano', 'click', function(e){
				$(this).closest('.case').toggleClass('pano');
			});
			story.delegate('.part>.partdel', 'click', function(e){
				$(this).parent().animate({
					opacity: 0, height: 0
				}, function() {
					$(this).remove();
				});
			});

			//*/// menu

			$('.btn-cases').on('click', function () {
				story.toggleClass('nocases');
			});
			$('.btn-texts').on('click', function () {
				story.toggleClass('notexts');
			});
			$('.btn-manage').on('click', function () {
				story.toggleClass('nomanage');
				var toggle = story.hasClass('nomanage') ? 'disable' : 'enable';
				$('.cases.sortable').sortable(toggle);
				$('.parts.sortable').sortable(toggle);
			});
			$('.btn-bigimg').on('click', function () {
				story.toggleClass('bigimg');
			});

			//*/// drop image

			story.delegate('.case img', 'dragenter', function(e){
				if(!dragcase) {
					e.stopPropagation();
					e.preventDefault();
					$(this).addClass('dragenter');
				}
			});
			story.delegate('.case img', 'dragleave', function(e){
				if(!dragcase) $(this).removeClass('dragenter');
			});
			story.delegate('.case img', 'dragover', function(e){
				if(!dragcase) {
					e.stopPropagation();
					e.preventDefault();
				}
			});
			story.delegate('.case img', 'drop', function(e){
				if(!dragcase) {
					e.preventDefault();
					var files = e.originalEvent.dataTransfer.files;
					$(this).removeClass('dragenter');
					$(this).attr('src', 'story_files/' + files[0].name);
				}
			});

			//*/// shortcuts

			function cleanup() {
				var attrs = [
					'data-sortable-id', 'data-item-sortable-id',
					'role', 'aria-grabbed', 'aria-dropeffect',
					'draggable', 'style'];
				$.each(attrs, function(id, val){
					$('*['+val+']').removeAttr(val);
				});
			}
			$(window).on('keydown', function(event) {
				if (event.ctrlKey || event.metaKey) {
					switch (String.fromCharCode(event.which).toLowerCase()) {
					case 'q':
						cleanup();
						alert('cleaned');
					}
				}
			});
		});
	</script>

</body></html>